<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Add React in One Minute</title>
    <link rel="stylesheet" type="text/css" href="style.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	
	
	<script src="https://code.jquery.com/jquery-2.2.4.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/10.1.0/nouislider.min.css" />
    <script src="./nouislider.min.js"></script>
	
	
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	
  </head>
  <body>
  
  
root
    <div id="root"></div>
	
	<div class="sticky">I will stick to the screen when you reach my scroll position</div>

<main>
<!--filter-->
<div class="catalog_sidebar">
  Континент
  <ul class="catalog_list">
    <li class="item">
      <input type="checkbox" id="room-1" value="Австралия">
      <label for="room-1" class="filter-item" >
        Австралия        
      </label>
    </li>
    <li class="item">
      <input type="checkbox" id="room-2" value="Африка">
      <label for="room-2" class="filter-item" >
        Африка        
      </label>
    </li>
    <li class="item">
      <input type="checkbox" id="room-3" value="Азия">
      <label for="room-3" class="filter-item" >
        Азия      
      </label>
    </li>
    <li class="item">
      <input type="checkbox" id="room-4" value="Северная_Америка">
      <label for="room-4" class="filter-item" >
        Северная_Америка      
      </label>
    </li>
    <li class="item">
      <input type="checkbox" id="room-5" value="Южная_Америка">
      <label for="room-5" class="filter-item" >
        Южная_Америка       
      </label>
    </li>
  </ul>
  
  Сорт
  <ul class="catalog_list">
    <li class="item">      
      <input type="checkbox" id="area-1" value="арабика">
      <label for="area-1" class="filter-item" >
        Арабика        
      </label>
    </li>
    <li class="item">
      <input type="checkbox" id="area-2" value="робуста">
      <label for="area-2" class="filter-item" >
        Робуста       
      </label>
    </li>
  </ul>
  
  
<p class=amount>
Цена: <input type="number" size="3" id="amount_n" step="10" min="10" max="100"> - <input type="number" size="3" id="amount_x" step="10" min="10" max="100"> грн.

<!-- <script> -->
<!-- $("#amount_n" || "#amount_x").keypress(function(e) { -->
        <!-- if (isNaN(String.fromCharCode(e.which))) e.preventDefault(); -->
    <!-- }); -->
<!-- </script> -->

<!-- <input type="text" size="10"  maxlength="50" onkeydown="size=value.length||10" onkeyup="onkeydown()" onkeypress="onkeydown()" onchange="onkeydown()"> -->
  <!-- <label for="amount">Цена: <span id=amount_n contenteditable></span> - <span id=amount_x contenteditable></span> грн.</label> -->
  <!-- <input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;"> -->
</p>
  <div class="slider-wrapper">
    <div id="range"></div>
  </div>
  
  <br>
  <div class="filter-res">
    Выбрано <span class="filter-slect">0</span> из <span class="filter-all">0</span> 
  </div>
  
</div>
<!--/filter-->





<!-- catalog_content -->
<div class="catalog_content">
 <select onchange="sorteds(this.value, this.selectedIndex)">
  <option value="tabindex">Рейтинг (низкий)</option>
  <option selected="selected" value="tabindex">Рейтинг (высокий)</option>
  <option value="data-price">Цена (по возрастанию)</option>
  <option value="data-price">Цена (по убыванию)</option>
  <option value="data-name">Наименование (А -> Я)</option>
  <option value="data-name">Наименование (Я -> А)</option>
</select>

<div id=basketCart></div>
<button id="checkout">Оформить заказ</button>
<button id="clear_cart">Очистить корзину</button>
<div id="cart_content"></div>


    <ul id="productData"></ul>
</div>	
<!-- /catalog_content -->
</main>

<!--	item_box
<div class="item_box">
  <h3 class="item_title">Samsung Galaxy S10</h3>
  <p>Цена: <span class="item_price">20</span>$</p>
  <button class="add_item" data-id="7">Добавить в корзину</button>
</div>
<div class="item_box">
  <h3 class="item_title">LG Optimus G E100500</h3>
  <p>Цена: <span class="item_price">100</span>$</p>
  <button class="add_item" data-id="2">Добавить в корзину</button>
</div>
  <div class="item_box">
  <h3 class="item_title">Nokia 2110</h3>
  <p>Цена: <span class="item_price">1000</span>$</p>
  <button class="add_item" data-id="5">Добавить в корзину</button>
</div>
<button id="checkout">Оформить заказ</button>
<button id="clear_cart">Очистить корзину</button>
<div id="cart_content"></div>
-->
<script>
function loadShop(a){

//max & min price
var min = Number(productData[0].price);
var max = Number(productData[0].price);
for (i = 0; i < productData.length; i++) {
var a=Number(productData[i].price);
      if(a < min){min = a;};
      if(a > max){max = a;};
  };
  var range = document.getElementById('range');
  range.setAttribute('min', min);
  range.setAttribute('max', max);
/*
    $( "#range" ).slider({
      range: true,
      min: min,
      max: max,
      values: [ min, max ],
      slide: function( event, ui ) {
        $( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
      }
    });
    $( "#amount" ).val( "$" + $( "#range" ).slider( "values", 0 ) +
      " - $" + $( "#range" ).slider( "values", 1 ) );
	  */

  
 //alert('min='+min+'  max='+max);
//\max & min price
 
//работа с корзиной
var d = document,
    itemBox = d.querySelectorAll('.goods-item'), // блок каждого товара
    cartCont = d.getElementById('cart_content'); // блок вывода данных корзины
// Функция кроссбраузерной установка обработчика событий
function addEvent(elem, type, handler){
  if(elem.addEventListener){
    elem.addEventListener(type, handler, false);
  } else {
    elem.attachEvent('on'+type, function(){ handler.call( elem ); });
  }
  return false;
}
// Получаем данные из LocalStorage
function getCartData(){
  return JSON.parse(localStorage.getItem('cart'));
}
// Записываем данные в LocalStorage
function setCartData(o){
  localStorage.setItem('cart', JSON.stringify(o));
  return false;
}
// Добавляем товар в корзину
function addToCart(e){
  this.disabled = true; // блокируем кнопку на время операции с корзиной
  var cartData = getCartData() || {}, // получаем данные корзины или создаём новый объект, если данных еще нет
      parentBox = this.parentNode, // родительский элемент кнопки "Добавить в корзину"
      itemId = this.getAttribute('data-id'), // ID товара
      itemTitle = parentBox.querySelector('.goods-item__title').innerHTML, // название товара
      itemPrice = parentBox.querySelector('.goods-item__price').innerHTML; // стоимость товара
  if(cartData.hasOwnProperty(itemId)){ // если такой товар уже в корзине, то добавляем +1 к его количеству
    cartData[itemId][2] += 1;
  } else { // если товара в корзине еще нет, то добавляем в объект
    cartData[itemId] = [itemTitle, itemPrice, 1];
  }
  if(!setCartData(cartData)){ // Обновляем данные в LocalStorage
    this.disabled = false; // разблокируем кнопку после обновления LS
	reloadCart();
  }
 return false;
}
// Обновляем количество товаров в корзине
function reloadCart(e){
  var cartData = getCartData(), // получаем данные корзины
      basketCart = document.getElementById('basketCart'); // блок корзины
  if(cartData !== null){
	var itemsN = 0,
	    itemsP = 0;
    for(var items in cartData){
        itemsN += cartData[items][2];
        itemsP += (cartData[items][1] * cartData[items][2]);
		
    }
	///////
    basketCart.innerHTML = 'В корзине '+itemsN+'шт. на сумму '+itemsP+'грн.';
  } else {
    // если в корзине пусто, то сигнализируем об этом
    basketCart.innerHTML = 'В корзине пусто!';
  }
 return false;
}
// Устанавливаем обработчик события на каждую кнопку "Добавить в корзину"
for(var i = 0; i < itemBox.length; i++){
  addEvent(itemBox[i].querySelector('.add-item'), 'click', addToCart);
}
// Открываем корзину со списком добавленных товаров
function openCart(e){
  var cartData = getCartData(), // вытаскиваем все данные корзины
      totalItems = '',
	  itemsN = 0,
	  itemsP = 0;
  // если что-то в корзине уже есть, начинаем формировать данные для вывода
  if(cartData !== null){
   totalItems = '<table class="shopping_list"><tr><th>Наименование</th><th>Цена</th><th>Кол-во</th></tr>';
    for(var items in cartData){
        itemsN += cartData[items][2];
        itemsP += (cartData[items][1] * cartData[items][2]);
      totalItems += '<tr>';
      for(var i = 0; i < cartData[items].length; i++){
        totalItems += '<td>' + cartData[items][i] + '</td>';
      }
      totalItems += '</tr>';
    }
    totalItems += '<tr><th>Всего:</th><th>'+itemsP+'грн.</th><th>'+itemsN+'шт.</th></tr></table>';
	///////
	let json = JSON.stringify(cartData);

    data1 = typeof json; // мы получили строку!

    data2 = json;
	cartCont.innerHTML = totalItems+"// data1: "+data1+"// data2: "+data2;    
    //cartCont.innerHTML = totalItems+"//"+cartData;
  } else {
    // если в корзине пусто, то сигнализируем об этом
    cartCont.innerHTML = 'В корзине пусто!';
  }
  return false;
}
/* Открыть корзину */
addEvent(d.getElementById('checkout'), 'click', openCart);
/* Очистить корзину */
addEvent(d.getElementById('clear_cart'), 'click', function(e){
  localStorage.removeItem('cart');
  reloadCart();
  cartCont.innerHTML = 'Корзина очишена.';
});
reloadCart();//Отобразить количество товаров в корзине
//\работа с корзиной







//jquery filterAll
var filterAll = $('.filter-all'),
    boxs = $('.goods-item'),
    length = boxs.length;
filterAll.text(length);  
$(".filter-slect").text(length);
var count_box;

var filter =   filter = new RegExp($(":checkbox:checked")
                         .map(function() {
						   //alert('/2/-'+this.value);
                           return this.value;
                         }).get().join("|") );
                         
$('input:checkbox').on('load change', function() {

  
  
  filter = new RegExp($(":checkbox:checked")
                         .map(function() {
						   //alert('/3/-'+this.value);
                           return this.value;
                         }).get().join("|") );
  
  $('.goods-item').each(function() {
    var $this = $(this);

    //alert($this.attr("class")+"-"+$this.data('price')+"-"+$this.data('name')+"-"+$this.data('grade')+"-/-");
    if(filter.test($this.attr("class")) ) {  
        $this.show();  
    }else{
       $this.hide();   
    } 
    if(filter.source == ""){
       $this["show"]; 
    }
  });    
  //alert( "2/// $" + $( "#range" ).slider( "values", 0 ) +" - $" + $( "#range" ).slider( "values", 1 ) );
  /*var values = [];
 values[0] = $(".noUi-handle.noUi-handle-lower").attr("aria-valuetext");
 values[1] = $(".noUi-handle.noUi-handle-upper").attr("aria-valuetext"); 
  range_change( values  );*/   
  range_change($( "#range" ).slider( "values", 0 ), $( "#range" ).slider( "values", 1 ));  
  
  count_box();  
});

// Range Slider
/*
var range = document.getElementById('range'),
    t = [],
    maximum = max;//parseInt(range.attributes.max.value, 10),
    minimum = min;//parseInt(range.attributes.min.value, 10),
    delta = (maximum - minimum) / 4,
    options = {
      min: [minimum],
      "25%": [minimum + delta * 1, 1e6],
      "50%": [minimum + delta * 2, 1e6],
      "75%": [minimum + delta * 3, 1e6],
      max: [maximum]
    };

//console.log(minimum + delta * 1, 1e6);

t.push(parseInt(range.attributes.min.value, 10)), 
  t.push(parseInt(range.attributes.max.value, 10));
var n = parseInt(range.attributes.max.value, 10); 
// i = parseInt(range.attributes.min.value, 10),

noUiSlider.create(
  range, 
  {
    range: options,
    start: t,
    connect: !0,
    pips: {
      mode: "range",
      density: 2
    }
  }
);

$(".noUi-value-horizontal").each(function() {
  var range = $(this).text().split("").slice(0, -6).join("");
  $(this).html(range);
});

function range_change(values, handle){ 
 $('.goods-item').each(function() {
    var $this = $(this);
        price = $this.data('price');
    
    var val1 =  values[0];
    var val2 =  values[1]; 
     
     
    if(price <= val2 && price >= val1 && filter.test($this.attr("class")) ) {
      $this.show();
    }else {
      $this.hide();
    } 
    
  }); 
}
range.noUiSlider.on('change', function(values, handle){ 
 range_change(values, handle); 
 count_box(); 
});
*/

    $( "#range" ).slider({
      range: true,
      min: min,
      max: max,
      values: [ min, max ],
      slide: function( event, ui ) {
        //$( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
        range_change_amount(ui.values[ 0 ], ui.values[ 1 ]); 
        range_change(ui.values[ 0 ], ui.values[ 1 ]); 
        count_box(); 
      }
    });
function range_change_amount(n, x){ 
    $( "#amount_n" ).val( n ).attr({min: min, max: max});
    $( "#amount_x" ).val( x ).attr({min: min, max: max});
}; range_change_amount( $( "#range" ).slider( "values", 0 ), $( "#range" ).slider( "values", 1 ));

//меняем положение ползунков в зависимости от введеного числа
$( "#amount_n" ).on( "change", function() {
let i = +this.value, 
    imax = +$( "#range" ).slider( "values", 1 );                     //alert(imax+' >= '+i+' >= '+min);
	i = (i > imax) ? i=imax : (min > i) ? i=min  : i;                //alert(imax+' >= '+i+' && '+i+' >= '+min);
	$( "#range" ).slider( "values", [ i, imax ] ); range_change(i, imax); range_change_amount(i, imax); count_box();
});
$( "#amount_x" ).on( "change", function() {
let i = +this.value,
    imin = +$( "#range" ).slider( "values", 0 );                    //alert(imax+' >= '+i+' >= '+min);
	i = (i > max) ? i=max : (imin > i) ? i=imin  : i;               //if(+max >= i && i >= imin){}else{ var i = imin; range_change_amount(imin, i);};
      $( "#range" ).slider( "values", [ imin, i ] ); range_change(imin, i); range_change_amount(imin, i); count_box();
});
//\меняем положение ползунков в зависимости от введеного числа
	  
function range_change(n, x){ 
 $('.goods-item').each(function() {
    var $this = $(this);
        price = $this.data('price');
    
    var val1 =  n;
    var val2 =  x; 
     
     
    if(price <= val2 && price >= val1 && filter.test($this.attr("class")) ) {
      $this.show();
    }else {
      $this.hide();
    } 
  }); 
};
function count_box() {
   countbox = $('#productData').find(".goods-item:visible").length; 
   $(".filter-slect").text(countbox);
}

/*
//$('#amount').oninput = function(){ alert('inp2');
 range_change(); 
 count_box(); 
};*/
	  



//   var filterSelect = $('.filter-select'),
//     boxs = $('.goods-item'),
//     length = boxs.length;
//     filterSelect.text(length);
//\//jquery filterAll






};




</script>


    <!-- Load React. -->
    <!-- Note: when deploying, replace "development.js" with "production.min.js". -->
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <!-- Don't use this in production: -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Load our React component. -->	
    <script type="text/babel">
ReactDOM.render(
  <h1>Привет, магазин!</h1>,
  document.getElementById('root')
);





const productData = [
    {
        id: 1,
        name: "Эфиопия",
		suffix: "Йоргачев",
		text: "text",
		price: "20",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 2,
        name: "Коста-Рика",
		text: "text",
		price: "120",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Северная_Америка",
		flag: ""
    },
    {
        id: 3,
        name: "Бурунди",
		text: "text",
		price: "30",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 4,
        name: "Бразилия",
		text: "text",
		price: "200",
		grade: "робуста",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
    {
        id: 5,
        name: "Колумбия",
		text: "text",
		price: "55",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
	{
        id: 6,
        name: "Эфиопия",
		suffix: "Йоргачев",
		text: "text",
		price: "20",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 7,
        name: "Коста-Рика",
		text: "text",
		price: "120",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Северная_Америка",
		flag: ""
    },
    {
        id: 8,
        name: "Бурунди",
		text: "text",
		price: "30",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 9,
        name: "Бразилия",
		text: "text",
		price: "200",
		grade: "робуста",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
    {
        id: 10,
        name: "Колумбия",
		text: "text",
		price: "55",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
	{
        id: 11,
        name: "Эфиопия",
		suffix: "Йоргачев",
		text: "text",
		price: "20",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 12,
        name: "Коста-Рика",
		text: "text",
		price: "120",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Северная_Америка",
		flag: ""
    },
    {
        id: 13,
        name: "Бурунди",
		text: "text",
		price: "30",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 14,
        name: "Бразилия",
		text: "text",
		price: "200",
		grade: "робуста",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
    {
        id: 15,
        name: "Колумбия",
		text: "text",
		price: "55",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
	{
        id: 16,
        name: "Эфиопия",
		suffix: "Йоргачев",
		text: "text",
		price: "20",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 17,
        name: "Коста-Рика",
		text: "text",
		price: "120",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Северная_Америка",
		flag: ""
    },
    {
        id: 18,
        name: "Бурунди",
		text: "text",
		price: "30",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Африка",
		flag: ""
    },
    {
        id: 19,
        name: "Бразилия",
		text: "text",
		price: "200",
		grade: "робуста",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    },
    {
        id: 20,
        name: "Колумбия",
		text: "text",
		price: "55",
		grade: "арабика",
		country: "Эфиопия",
		continent: "Южная_Америка",
		flag: ""
    }
]

const productDataComponents = productData.map(data => <li key={data.id} id={'product_'+data.id} className={'goods-item '+data.grade+' '+data.country+' '+data.continent} tabIndex={data.id} data-price={data.price} data-name={data.name} data-grade={data.grade}><div className="goods-item__img" title={data.name}></div><a className="goods-item__title" href={'product_'+data.id}>{data.name}</a><p className="goods-item__price">{data.price}</p>{data.grade}<br/>{data.country}<br/>{data.continent}<br/><button className="add-item" data-id={data.id}><span className="add-item__icons">shopping_cart</span> в корзину</button></li>)
ReactDOM.render(
  productDataComponents,
  document.getElementById('productData')
),loadShop(1);




</script>




<script> 
//Скрипт сортировки товаов
function sorteds(e, i){
// e - передаваемый атрибут сортировки (цена, название, ...) 
// i - индкес реверса (четный=А-Я, нечетный=Я-А)
  const resultEl = document.getElementById('productData');  //контейнер
  const elements = document.querySelectorAll('.goods-item');  //объекты сортировки
if(e=='data-name'){  //Сортировка массива в алфавитном порядке
  const sorted = [...elements].sort((a, b) => {
    const getName = (el) => el.getAttribute(e).replace(/ /g, "");
    if(i % 2){return getName(b).localeCompare(getName(a));}else{ return getName(a).localeCompare(getName(b));};
  });
  resultEl.innerHTML = null;
  sorted.forEach(el => resultEl.appendChild(el));
}else{  //Сортировка массива в числовом порядке
  const sorted = [...elements].sort((a, b) => {
    const getPrice = (el) => parseInt(el.getAttribute(e).replace(/ /g, ""));
        if(i % 2){return getPrice(b) - getPrice(a);}else{return getPrice(a) - getPrice(b);};
  });
  resultEl.innerHTML = null;
  sorted.forEach(el => resultEl.appendChild(el));
};
};
//Скрипт сортировки товаов
  </script>
</body>
</html>

